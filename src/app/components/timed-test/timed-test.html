<app-navbar></app-navbar>

<div class="test-container mt-5">
  <div class="d-flex justify-content-between align-items-center py-3 px-4 border-bottom flex-wrap gap-2"
    *ngIf="!isUnlimitedMode">
    <div class="d-flex align-items-center gap-2 fw-semibold text-dark">
      <i class="bi bi-clock text-primary"></i>
      <span>Temps restant: {{ formatTime(timeRemaining) }}</span>
    </div>
    <div class="small text-secondary">
      Question {{ currentQuestionIndex + 1 }} de {{ questions.length }}
    </div>
  </div>

  <div class="d-flex justify-content-between align-items-center  py-3 px-4 border-bottom flex-wrap gap-2"
    *ngIf="isUnlimitedMode">
    <div class="small text-secondary">
      Question {{ currentQuestionIndex + 1 }} de {{ questions.length }}
    </div>
    <div class="d-flex align-items-center gap-2 fw-semibold text-dark">
      <i class="bi bi-infinity text-success"></i>
      <span>Mode temps illimité</span>
    </div>
  </div>

  <!-- Progress Bar -->
  <div class="progress rounded-0" style="height: 6px;">
    <div class="progress-bar bg-primary" [style.width.%]="getProgress()"></div>
  </div>

  <!-- Question Content -->
  <div class="content-wrapper mx-auto py-5 px-3 px-md-4">
    <div class=" rounded-4 p-4 p-md-5 " *ngIf="currentQuestion">
      <!-- Subject Badge -->
      <span class="badge rounded-pill text-primary px-3 py-2 mb-3" *ngIf="currentQuestion.subject">
        {{ currentQuestion.subject }}
      </span>

      <!-- Question Number and Title -->
      <h2 class="fs-4 fw-bold text-dark mb-4">Question {{ currentQuestion.number }}</h2>
      <markdown [data]="currentQuestion.text" class="question-text lh-base text-dark mb-4 d-block"></markdown>

      <!-- Subquestions if any -->
      <div class="p-4 mb-4" *ngIf="currentQuestion.subQuestions && currentQuestion.subQuestions.length > 0">
        <div class="mb-3" *ngFor="let subQuestion of currentQuestion.subQuestions; last as isLast"
          [class.mb-0]="isLast">
          <p class="text-dark mb-2">{{subQuestion.label+")"}} {{ subQuestion.text }}</p>
          <div class="hint d-flex align-items-center gap-2 p-3 rounded-2" *ngIf="subQuestion.hint">
            <markdown [data]="subQuestion.hint" class="hint-text"></markdown>
          </div>
        </div>
      </div>

      <!-- Answer Input -->
      <div class="mb-4">
        <label class="form-label fw-semibold text-dark">Votre réponse</label>
        <textarea class="form-control" [(ngModel)]="currentQuestion.userAnswer"
          placeholder="Entrez votre réponse ici..." rows="3">
        </textarea>
      </div>

      <!-- Navigation Buttons -->
      <div class="d-flex justify-content-between mb-4 flex-column flex-md-row gap-3">
        <button class="btn btn-light d-flex align-items-center justify-content-center gap-2 px-4 py-2"
          (click)="previousQuestion()" [disabled]="currentQuestionIndex === 0">
          <i class="bi bi-chevron-left"></i>
          Précédent
        </button>

        <button *ngIf="currentQuestionIndex < questions.length - 1"
          class="btn btn-primary d-flex align-items-center justify-content-center gap-2 px-4 py-2"
          (click)="nextQuestion()">
          Suivant
          <i class="bi bi-chevron-right"></i>
        </button>

        <button *ngIf="currentQuestionIndex === questions.length - 1"
          class="btn btn-primary d-flex align-items-center justify-content-center gap-2 px-4 py-2"
          (click)="submitTest()">
          <i class="bi bi-check-lg"></i>
          Soumettre
        </button>
      </div>

      <div class="d-flex gap-2 flex-wrap justify-content-center">
        <button *ngFor="let q of questions; let i = index" class="page-number btn btn-outline-secondary"
          [class.active]="i === currentQuestionIndex" [class.answered]="q.userAnswer" (click)="goToQuestion(i)">
          {{ i + 1 }}
        </button>
      </div>
    </div>
  </div>
</div>