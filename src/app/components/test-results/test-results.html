<app-test-header></app-test-header>

    <div class="min-vh-100 bg-light py-5 px-3 px-md-4">
      <div class="container">
        <!-- Test Complete Header -->
        <div class="card shadow-sm border-0 rounded-4 mb-4 mb-md-5">
          <div class="card-body text-center p-4 p-md-5">
            <h1 class="display-4 fw-bold mb-2">Test Complete!</h1>
            <p class="text-muted mb-4 mb-md-5">Timed Test Results</p>

            <!-- Score Display -->
            <div class="d-flex flex-column flex-md-row align-items-center justify-content-center gap-4 gap-md-5 mb-4">
              <div class="text-center">
                <div class="display-1 fw-bold text-primary mb-2">{{ scorePercentage }}%</div>
                <div class="text-muted small">Score</div>
              </div>

              <div class="d-none d-md-block" style="width: 1px; height: 60px; background-color: #e5e7eb;"></div>
              <div class="d-md-none w-100" style="height: 1px; background-color: #e5e7eb;"></div>

              <div class="text-center">
                <div class="display-1 fw-bold text-dark mb-2">{{ correctCount }} / {{ totalQuestions }}</div>
                <div class="text-muted small">Correct Answers</div>
              </div>
            </div>

            <!-- Breakdown -->
            <div class="d-flex flex-column flex-md-row align-items-center justify-content-center gap-3 gap-md-4">
              <div class="d-flex align-items-center gap-2 text-success">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="10" fill="#10b981"/>
                  <path d="M8 12L11 15L16 9" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="fw-semibold">{{ correctCount }} Correct</span>
              </div>
              <div class="d-flex align-items-center gap-2 text-danger">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="10" fill="#ef4444"/>
                  <path d="M8 8L16 16M16 8L8 16" stroke="white" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="fw-semibold">{{ incorrectCount }} Incorrect</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Detailed Results -->
        <div class="card shadow-sm border-0 rounded-4 mb-4">
          <div class="card-body p-4 p-md-5">
            <h2 class="display-5 fw-bold mb-2">Detailed Results</h2>
            <p class="text-muted mb-4">
              Click on any question to view the correct answer and step-by-step solution
            </p>

            <div class="d-flex flex-column gap-3">
              <div
                *ngFor="let result of results"
                class="card border-2 rounded-3"
                [class.border-primary]="result.number === expandedQuestion"
                [class.border-secondary]="result.number !== expandedQuestion"
                style="cursor: pointer;"
                (click)="toggleQuestion(result.number)">
                <div class="card-body p-3 p-md-4">
                  <div class="d-flex align-items-start justify-content-between gap-3">
                    <div class="d-flex align-items-start gap-3 flex-grow-1">
                      <div class="flex-shrink-0 mt-1">
                        <svg *ngIf="!result.isCorrect" width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2" fill="none"/>
                          <path d="M8 8L16 16M16 8L8 16" stroke="#ef4444" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <svg *ngIf="result.isCorrect" width="24" height="24" viewBox="0 0 24 24" fill="none">
                          <circle cx="12" cy="12" r="10" stroke="#10b981" stroke-width="2" fill="none"/>
                          <path d="M8 12L11 15L16 9" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                      </div>
                      <div class="flex-grow-1">
                        <div class="d-flex flex-wrap align-items-center gap-2 mb-2">
                          <span class="fw-bold fs-5">Question {{ result.number }}</span>
                          <span class="badge bg-info" *ngIf="result.subject">{{ result.subject }}</span>
                        </div>
                        <div class="text-dark">{{ result.text }}</div>
                      </div>
                    </div>
                    <i class="bi bi-chevron-down flex-shrink-0" [class.bi-chevron-up]="result.number === expandedQuestion"></i>
                  </div>

                  <div *ngIf="result.number === expandedQuestion" class="mt-4 pt-4 border-top">
                    <div class="row g-3 mb-4">
                      <div class="col-12 col-md-6">
                        <div class="p-3 rounded-3 border-2 border-danger bg-danger bg-opacity-10">
                          <div class="small text-uppercase fw-bold text-muted mb-2">Your Answer</div>
                          <div class="text-dark">{{ result.userAnswer || 'No answer provided' }}</div>
                        </div>
                      </div>
                      <div class="col-12 col-md-6">
                        <div class="p-3 rounded-3 border-2 border-success bg-success bg-opacity-10">
                          <div class="small text-uppercase fw-bold text-muted mb-2">Correct Answer</div>
                          <div class="text-dark">{{ result.correctAnswer }}</div>
                        </div>
                      </div>
                    </div>

                    <div class="p-3 bg-light rounded-3 mb-3" *ngIf="result.explanation">
                      <div class="fw-semibold mb-2">Explanation</div>
                      <p class="mb-0">{{ result.explanation }}</p>
                    </div>

                    <div class="mb-3" *ngIf="result.steps && result.steps.length > 0">
                      <div class="fw-semibold mb-2">Step-by-Step Solution</div>
                      <ol class="ps-4">
                        <li *ngFor="let step of result.steps" class="mb-2">{{ step }}</li>
                      </ol>
                    </div>

                    <div class="text-muted small">
                      <strong>Points:</strong> {{ result.earnedPoints }} / {{ result.points }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Back to Home Button -->
        <div class="text-center">
          <button class="btn btn-primary btn-lg rounded-pill px-4 py-2" (click)="goHome()">
            <i class="bi bi-house-door me-2"></i>
            Back to Home
          </button>
        </div>
      </div>
    </div>