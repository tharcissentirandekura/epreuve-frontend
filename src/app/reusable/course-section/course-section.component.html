<app-navbar></app-navbar>
<div class="container-fluid app-container-responsive mt-5 mb-5 flex-grow-1">
    <!-- Header -->
    <div class="row mb-4 justify-content-center">
        <div class="col-12 d-flex justify-content-center align-items-center flex-wrap gap-3">
            <h1 class="main-title mb-0 text-center app-text-responsive">{{ sectionTitle }}</h1>
            <!-- <button class="btn btn-outline-secondary d-flex align-items-center rounded-pill px-3 py-2" (click)="resetFilters()">
                <i class="pi pi-sync me-2"></i>
                <span class="d-none d-sm-inline">Réinitialiser</span>
            </button> -->
        </div>
    </div>

    <!-- Search Bar -->
    <div class="row mb-4">
        <div class="col-md-8 col-lg-6 mx-auto">
            <div class="app-search-container rounded-5 p-2">
                <i class="pi pi-search search-icon fs-4"></i>
                <input type="text" class="search-input border-1" placeholder="Rechercher par titre ou cours"
                    [(ngModel)]="searchTerm" (input)="onSearchInput($event)" />
            </div>
        </div>
    </div>

    <!-- Course Filter Tabs + “Vidéos” -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="app-filter-tabs">
                <button class="filter-tab" [class.active]="!selectedCourse && !showVideos"
                    (click)="showVideos = false; onCourseSelect('')">
                    Tous
                </button>
                <button *ngFor="let course of uniqueCourses" class="filter-tab"
                    [class.active]="selectedCourse === course && !showVideos"
                    (click)="showVideos = false; onCourseSelect(course)">
                    {{ course }}
                </button>
                <button class="filter-tab" [class.active]="showVideos" (click)="showVideos = true">
                    Vidéos
                </button>
            </div>
        </div>
    </div>

    <!-- TESTS LIST -->
    <ng-container *ngIf="!showVideos">
        <div class="bg-white rounded-4 p-4 shadow-sm" *ngIf="filteredTests.length > 0">
            <!-- Pagination -->
            <app-paginator 
            [totalPages]="totalPages" 
            [count]="count" 
            [currentPage]="currentPage"
            [previous]="previous" 
            [next]="next"
            [pageSize]="pageSize"
            (pageChange)="goToPage($event)"
            (pageSizeChange)="onPageSizeChange($event)">
          </app-paginator>

            <!-- Test Items -->
            <div class="list-group list-group-flush">
                <div *ngFor="let t of filteredTests; trackBy: trackByTest"
                    class="list-group-item border-0 rounded-4 mb-2 app-list-item-hover">
                    <div class="row align-items-center g-3">
                        <div class="col-12 col-md-7 col-lg-6">
                            <div class="fw-bold text-primary mb-1 app-text-truncate" [title]="normalizeCourseName(t)">
                                {{normalizeCourseName(t)}}</div>
                            <div class="d-flex flex-wrap gap-3 small text-muted">
                                <span><i class="pi pi-calendar me-1"></i>{{ t.year | date:'yyyy' }}</span>
                                <span><i class="pi pi-book me-1"></i>{{t.course}}</span>
                                <span><i class="pi pi-file me-1"></i>{{convertFIleSize(t.metadata.size)}}</span>
                            </div>
                        </div>
                        <div class="col-12 col-md-5 col-lg-6 text-md-end">
                            <a [href]="t.link" target="_blank" rel="noreferrer" class="btn btn-primary rounded-pill px-4">
                                <i class="pi pi-cloud-download me-2"></i>
                                Télécharger
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- No Results -->
        <div *ngIf="filteredTests.length === 0" class="text-center py-5">
            <i class="pi pi-search fs-1 text-secondary mb-3"></i>
            <p class="fs-5 text-muted mb-4">Aucun test ne correspond à vos critères de recherche.</p>
            <button class="btn btn-outline-primary rounded-pill px-4" (click)="resetFilters()">
                Réinitialiser
            </button>
        </div>
    </ng-container>

    <!-- Video Cards -->
    <ng-container *ngIf="showVideos">
        <div class="row g-4">
            <div *ngFor="let v of videoList; trackBy: trackByVideo" class="col-lg-3 col-md-4 col-sm-6">
                <div class="card h-100 border-0 shadow-sm rounded-4 app-card-hover">
                    <img [src]="v.thumbnailUrl" alt="{{ v.title }}" class="card-img-top rounded-top-4" />
                    <div class="card-body d-flex flex-column">
                        <h5 class="card-title text-center fw-bold text-primary flex-grow-1 app-text-truncate-2-lines"
                            [title]="v.title">
                            {{ v.title }}
                        </h5>
                        <a [href]="v.youtubeLink" target="_blank" rel="noreferrer" class="btn btn-primary rounded-pill w-100 mt-auto">
                            <i class="pi pi-youtube me-2"></i>
                            Regarder
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</div>
<app-footer></app-footer>