<div class="search-bar d-flex align-items-center">
    <a *ngIf="!isSearchBarVisible" class="nav-link me-3 search-toggle-button px-3 py-2" href="#"
        (click)="toggleSearchBar($event)">
        <i class="bi bi-search fa-lg"></i>
    </a>

    <!-- Floating Search Bar -->
    <div *ngIf="isSearchBarVisible" class="floating-search-bar d-flex justify-content-center align-items-start">
        <div class="search-bar-container p-2">
            <div class="search-input-wrapper position-relative d-flex align-items-center">
                <i class="bi bi-search search-icon"></i>
                <input type="text" class="form-control form-control-lg search-input w-100 py-3"
                    placeholder="Rechercher les cours, sections, épreuves..." aria-label="Search"
                    [(ngModel)]="searchQuery" (input)="onSearch()" />
                <button type="button" class="btn-close text-white fw-bold" (click)="toggleSearchBar($event)">

                </button>
            </div>

            <!-- Loading state -->
            <div *ngIf="isSearching" class="search-loading text-center py-4">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Recherche en cours...</span>
                </div>
                <p class="mt-2 text-muted">Recherche en cours...</p>
            </div>

            <!-- Error message -->
            <div *ngIf="searchError && !isSearching" class="search-error alert alert-warning m-3" role="alert">
                <i class="bi bi-exclamation-triangle me-2"></i>
                {{ searchError }}
            </div>

            <!-- Search results -->
            <div *ngIf="searchResults.length > 0 && !isSearching" class="search-results overflow-auto">
                <ul class="list-group list-group-flush tests-list">
                    <li *ngFor="let result of searchResults" class="list-group-item px-5 mb-1">
                        <div class="row align-items-center w-100 gx-2">
                            <div class="col-12 col-md-7 col-lg-6">
                                <div class="test-name mb-1 fw-bold" [title]="result.name">
                                    <a [href]="result.url" target="_blank" rel="noreferrer" rel="noopener noreferrer" class="text-decoration-none">{{result.name}}</a>
                                </div>
                                <div class="d-flex flex-row gap-2">
                                    <small class="text-muted">{{result.metadata?.section || ''}}</small>
                                    <small class="text-muted">{{result.metadata?.course || ''}}</small>
                                </div>
                            </div>
                            <div class="col-12 col-md-5 col-lg-6 text-lg-end mt-2 mt-lg-0">
                                <div class="d-flex gap-2 justify-content-lg-end">
                                    <a [href]="result.url" class="btn btn-sm">
                                        <i class="bi bi-cloud-download me-1"></i>
                                        Ouvrir
                                    </a>
                                    <button *ngIf="isFeatureOn" class="btn btn-sm" (click)="useChatBot(result)">
                                        <i class="bi bi-robot me-1"></i>
                                        Chat
                                    </button>
                                    <button *ngIf="isFeatureOn" class="btn btn-sm" (click)="viewOnline(result)">
                                        <i class="bi bi-eye me-1"></i>
                                        Voir
                                    </button>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>

            <!-- No results message -->
            <div *ngIf="!isSearching && !searchError && searchQuery && searchResults.length === 0" class="search-no-results text-center py-4">
                <p class="text-muted">Aucun résultat trouvé pour "{{ searchQuery }}"</p>
            </div>
        </div>
    </div>
</div>